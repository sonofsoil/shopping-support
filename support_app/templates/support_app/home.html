{% extends "support_app/layout.html" %}
{% block title %}
  Home
{% endblock %}
{% block content %}
    <div id = "home" class="body-content">
      <div class="split left">
        <form method="POST" class="url-form">
          {% csrf_token %}
          {{ form.as_p }}
          <button id="submit" type="button" class="save btn btn-default">Submit</button>
        </form>
        <p style="width:90%;">
          {{ interaction.user_id }}: {{ interaction.user_query }}
        </p>
        <p id = "expert_answer" style="width:90%;">
          Ordering Expert: {{ interaction.expert_answer }}
        </p>
      </div>
      <div class="split right">
        <h2>Trace Console</h2>
        <div class="scrollbox">
          <p id="trace_console"></p>
        </div>
      </div>
    </div>
    <script>
      document.querySelector('#submit').onclick = function (e) {
         const user_id = document.querySelector('#id_user_id').value;
         const user_query = document.querySelector('#id_user_query').value;
         webSocket.send(JSON.stringify({
             'user_id': user_id,
             'user_query': user_query,
         }));
         document.querySelector('#id_user_query').value = '';
      };
   
      //Create a WebSocket in JavaScript.
      const webSocket = new WebSocket('ws://127.0.0.1:8000/ws/trace/');

      webSocket.onmessage = function (e) {
        var data = JSON.parse(event.data);
        switch(data.type) {
          case "Trace":
            console.log(data.message)
            switch(data.message.type) {
              case "Thought":
                document.querySelector('#trace_console').innerText += data.message.thought;
                document.querySelector('#trace_console').innerText += data.message.action;
                document.querySelector('#trace_console').innerText += data.message.actionInput;
                break;
              case "Tool":
                document.querySelector('#trace_console').innerText += data.message.message;
                break;
              case "Answer":
                document.querySelector('#trace_console').innerText += data.message.thought;
                document.querySelector('#trace_console').innerText += data.message.answer;
                break;
            }
            break;
          case "Answer":
            document.querySelector('#expert_answer').innerText = data.message;
            break;
        }
      }
    </script>
{% endblock %}